<!DOCTYPE html>
<html>
<head>
    <title>Quick RSS Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <h1>Quick RSS Integration Test</h1>
    
    <div id="results"></div>
    
    <button onclick="testIntegration()">Test RSS Integration</button>

    <script src="rss-manager.js"></script>
    <script src="app.js"></script>
    <script>
        function addResult(title, content, className = '') {
            const div = document.createElement('div');
            div.className = `test ${className}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            document.getElementById('results').appendChild(div);
        }

        async function testIntegration() {
            document.getElementById('results').innerHTML = '';
            
            addResult('Step 1: Check RSS Manager', 
                window.letterboxdRSS ? 'RSS Manager is available ✅' : 'RSS Manager is NOT available ❌',
                window.letterboxdRSS ? 'success' : 'error'
            );
            
            if (!window.letterboxdRSS) return;
            
            addResult('Step 2: Test RSS Manager Init', 'Initializing RSS manager...');
            
            try {
                const initialized = window.letterboxdRSS.init('ghosteffect', true);
                addResult('RSS Manager Init Result', 
                    `Initialized: ${initialized} | Available: ${window.letterboxdRSS.isLiveDataAvailable()}`,
                    initialized ? 'success' : 'error'
                );
                
                if (initialized) {
                    addResult('Step 3: Test RSS Fetch', 'Testing RSS fetch...');
                    
                    const entries = await window.letterboxdRSS.getRecentDiaryEntries(3);
                    addResult('RSS Fetch Result', 
                        `Found ${entries.length} entries`,
                        entries.length > 0 ? 'success' : 'error'
                    );
                    
                    if (entries.length > 0) {
                        addResult('Sample Entry', `
                            <pre>${JSON.stringify(entries[0], null, 2)}</pre>
                        `);
                    }
                }
                
            } catch (error) {
                addResult('RSS Test Error', `Error: ${error.message}`, 'error');
            }
            
            addResult('Step 4: Test App Integration', 'Testing main app integration...');
            
            if (window.app) {
                addResult('App Available', 'Main app is loaded ✅', 'success');
                
                // Test if app has currentUser
                if (window.app.currentUser) {
                    addResult('Current User', `
                        User: ${window.app.currentUser.displayName}<br>
                        Live Data Enabled: ${window.app.currentUser.enableLiveData}<br>
                        Username: ${window.app.currentUser.letterboxdUsername}
                    `, 'success');
                } else {
                    addResult('Current User', 'No current user set', 'error');
                }
                
                // Test toggle elements
                const toggle = document.getElementById('live-data-toggle');
                const switchEl = document.getElementById('liveDataSwitch');
                
                addResult('Toggle Elements', `
                    Toggle div: ${toggle ? 'Found' : 'Not found'}<br>
                    Switch input: ${switchEl ? 'Found' : 'Not found'}<br>
                    Toggle visible: ${toggle && !toggle.classList.contains('d-none') ? 'Yes' : 'No'}
                `, toggle && switchEl ? 'success' : 'error');
                
            } else {
                addResult('App Available', 'Main app is NOT loaded ❌', 'error');
            }
        }
    </script>
</body>
</html>
