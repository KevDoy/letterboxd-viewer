<!DOCTYPE html>
<html>
<head>
    <title>Test RSS Improvements</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
    </style>
</head>
<body>
    <h1>Test RSS Title and Rating Extraction</h1>
    
    <button onclick="testTitleExtraction()">Test Title Extraction</button>
    <button onclick="testRatingExtraction()">Test Rating Extraction</button>
    <button onclick="testLiveRSS()">Test Live RSS</button>
    
    <div id="results"></div>

    <script src="rss-manager.js"></script>
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }

        function testTitleExtraction() {
            document.getElementById('results').innerHTML = '';
            
            const rssManager = window.letterboxdRSS;
            
            // Test cases based on typical Letterboxd RSS titles
            const testCases = [
                {
                    title: "ghosteffect watched The Fantastic Four: First Steps, 2025 ★★★★",
                    link: "https://letterboxd.com/ghosteffect/film/the-fantastic-four-first-steps/",
                    description: "Watched on 13 Aug 2025",
                    expected: { title: "The Fantastic Four: First Steps", year: 2025, rating: 4 }
                },
                {
                    title: "ghosteffect rated Deadpool & Wolverine ★★★★½",
                    link: "https://letterboxd.com/ghosteffect/film/deadpool-wolverine/", 
                    description: "Rated on 12 Aug 2025",
                    expected: { title: "Deadpool & Wolverine", rating: 4.5 }
                },
                {
                    title: "ghosteffect watched Alien: Romulus",
                    link: "https://letterboxd.com/ghosteffect/film/alien-romulus/",
                    description: "Watched on 11 Aug 2025",
                    expected: { title: "Alien: Romulus" }
                }
            ];
            
            testCases.forEach((testCase, index) => {
                const result = rssManager.extractFilmInfo(testCase.title, testCase.link, testCase.description);
                
                let success = true;
                let details = `<strong>Test ${index + 1}:</strong> "${testCase.title}"<br>`;
                
                if (testCase.expected.title && result.title !== testCase.expected.title) {
                    success = false;
                    details += `❌ Title: Expected "${testCase.expected.title}", got "${result.title}"<br>`;
                } else if (testCase.expected.title) {
                    details += `✅ Title: "${result.title}"<br>`;
                }
                
                if (testCase.expected.year && result.year !== testCase.expected.year) {
                    success = false;
                    details += `❌ Year: Expected ${testCase.expected.year}, got ${result.year}<br>`;
                } else if (testCase.expected.year) {
                    details += `✅ Year: ${result.year}<br>`;
                }
                
                if (testCase.expected.rating && result.rating !== testCase.expected.rating) {
                    success = false;
                    details += `❌ Rating: Expected ${testCase.expected.rating}, got ${result.rating}<br>`;
                } else if (testCase.expected.rating) {
                    details += `✅ Rating: ${result.rating}<br>`;
                }
                
                addResult(details, success ? 'success' : 'error');
            });
        }

        function testRatingExtraction() {
            const rssManager = window.letterboxdRSS;
            
            const ratingTests = [
                { input: "★★★★★", expected: 5 },
                { input: "★★★★½", expected: 4.5 },
                { input: "★★★", expected: 3 },
                { input: "★½", expected: 1.5 },
                { input: "½", expected: 0.5 }
            ];
            
            ratingTests.forEach((test, index) => {
                const title = `User watched Movie ${test.input}`;
                const result = rssManager.extractFilmInfo(title, '', '');
                
                const success = result.rating === test.expected;
                const message = `<strong>Rating Test ${index + 1}:</strong> "${test.input}" → Expected: ${test.expected}, Got: ${result.rating}`;
                
                addResult(message, success ? 'success' : 'error');
            });
        }

        async function testLiveRSS() {
            try {
                const rssManager = window.letterboxdRSS;
                rssManager.init('ghosteffect', true);
                rssManager.clearCache();
                
                addResult('🔄 Fetching live RSS data...', 'info');
                
                const entries = await rssManager.getRecentDiaryEntries(3);
                
                if (entries.length > 0) {
                    addResult(`✅ Successfully fetched ${entries.length} entries`, 'success');
                    
                    entries.forEach((entry, index) => {
                        const details = `
                            <strong>Entry ${index + 1}:</strong><br>
                            Name: ${entry.Name}<br>
                            Year: ${entry.Year}<br>
                            Rating: ${entry.Rating}<br>
                            Date: ${entry.Date}
                        `;
                        addResult(details, 'success');
                    });
                } else {
                    addResult('❌ No entries returned', 'error');
                }
                
            } catch (error) {
                addResult(`❌ Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
