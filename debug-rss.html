<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple RSS Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
    </style>
</head>
<body>
    <h1>Letterboxd RSS Debug Test</h1>
    <button onclick="runDebugTest()">Run Debug Test</button>
    <div id="results"></div>

    <script>
        async function runDebugTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="info">Starting debug test...</div>';
            
            const username = 'kevdoy';
            
            // Test 1: Check if we can access Letterboxd at all
            try {
                results.innerHTML += '<div class="info">Test 1: Testing basic Letterboxd access...</div>';
                
                const testUrl = `https://api.allorigins.win/get?url=${encodeURIComponent('https://letterboxd.com/')}`;
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (data.contents && data.contents.includes('letterboxd')) {
                    results.innerHTML += '<div class="success">✅ Basic Letterboxd access works</div>';
                } else {
                    results.innerHTML += '<div class="error">❌ Basic Letterboxd access failed</div>';
                    return;
                }
            } catch (error) {
                results.innerHTML += `<div class="error">❌ Basic access error: ${error.message}</div>`;
                return;
            }
            
            // Test 2: Check user profile
            try {
                results.innerHTML += '<div class="info">Test 2: Testing user profile access...</div>';
                
                const profileUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://letterboxd.com/${username}/`)}`;
                const response = await fetch(profileUrl);
                const data = await response.json();
                
                if (data.contents && data.contents.includes(username) && !data.contents.includes('Page not found')) {
                    results.innerHTML += '<div class="success">✅ User profile exists and is accessible</div>';
                } else {
                    results.innerHTML += '<div class="error">❌ User profile not found or not accessible</div>';
                    results.innerHTML += `<div class="info">Profile response length: ${data.contents ? data.contents.length : 'null'}</div>`;
                    return;
                }
            } catch (error) {
                results.innerHTML += `<div class="error">❌ Profile access error: ${error.message}</div>`;
                return;
            }
            
            // Test 3: Check RSS feed
            try {
                results.innerHTML += '<div class="info">Test 3: Testing RSS feed access...</div>';
                
                const rssUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://letterboxd.com/${username}/rss/`)}`;
                const response = await fetch(rssUrl);
                const data = await response.json();
                
                results.innerHTML += `<div class="info">RSS response status: ${response.status}</div>`;
                results.innerHTML += `<div class="info">RSS content length: ${data.contents ? data.contents.length : 'null'}</div>`;
                
                if (data.contents) {
                    const preview = data.contents.substring(0, 300);
                    results.innerHTML += `<div class="info">RSS content preview:<br><pre>${preview}...</pre></div>`;
                    
                    // Try to parse as XML
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                    
                    const parseError = xmlDoc.querySelector('parsererror');
                    if (parseError) {
                        results.innerHTML += `<div class="error">❌ XML parsing failed: ${parseError.textContent}</div>`;
                    } else {
                        results.innerHTML += '<div class="success">✅ XML parsing successful</div>';
                        
                        const items = xmlDoc.querySelectorAll('item');
                        const entries = xmlDoc.querySelectorAll('entry');
                        
                        results.innerHTML += `<div class="info">Found ${items.length} RSS items</div>`;
                        results.innerHTML += `<div class="info">Found ${entries.length} Atom entries</div>`;
                        
                        if (items.length > 0) {
                            const firstItem = items[0];
                            const title = firstItem.querySelector('title')?.textContent || 'No title';
                            const link = firstItem.querySelector('link')?.textContent || 'No link';
                            results.innerHTML += `<div class="success">✅ First item: ${title}</div>`;
                            results.innerHTML += `<div class="info">Link: ${link}</div>`;
                        }
                    }
                } else {
                    results.innerHTML += '<div class="error">❌ No RSS content received</div>';
                }
            } catch (error) {
                results.innerHTML += `<div class="error">❌ RSS access error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
