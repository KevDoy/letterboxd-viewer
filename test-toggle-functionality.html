<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Toggle Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="rss-manager.js"></script>
    <script src="app.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>RSS Toggle Test</h1>
        
        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="liveDataSwitch">
            <label class="form-check-label" for="liveDataSwitch">
                Live Data Toggle
            </label>
        </div>
        
        <div id="output"></div>
        <div id="toast-container" class="position-fixed top-0 end-0 p-3"></div>
    </div>

    <script>
        // Test RSS toggle functionality
        async function testToggle() {
            const output = document.getElementById('output');
            
            try {
                // Initialize RSS manager
                window.letterboxdRSS = new LetterboxdRSSManager();
                
                // Create a mock user for testing
                const mockUser = {
                    id: 'testuser',
                    letterboxdUsername: 'filmcritic',
                    enableLiveData: true
                };
                
                // Initialize the app with mock data
                const app = new LetterboxdViewer();
                app.currentUser = mockUser;
                app.data = {
                    diary: [],
                    watched: []
                };
                window.viewer = app;
                
                output.innerHTML = '<p>‚úÖ App initialized with mock user</p>';
                
                // Test the toggle functionality
                const toggle = document.getElementById('liveDataSwitch');
                toggle.addEventListener('change', async () => {
                    output.innerHTML += `<p>üîÑ Toggle changed to: ${toggle.checked}</p>`;
                    
                    try {
                        await app.toggleLiveData(toggle.checked);
                        output.innerHTML += '<p>‚úÖ Toggle function completed successfully</p>';
                    } catch (error) {
                        output.innerHTML += `<p>‚ùå Toggle error: ${error.message}</p>`;
                    }
                });
                
                output.innerHTML += '<p>üéØ Ready! Try clicking the toggle above.</p>';
                
            } catch (error) {
                output.innerHTML += `<p>‚ùå Initialization error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', testToggle);
    </script>
</body>
</html>
