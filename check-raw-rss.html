<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Raw RSS Feed</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 11px; }
    </style>
</head>
<body>
    <h1>Raw RSS Feed Check</h1>
    <p>Checking the raw RSS feed content to see what's available.</p>
    
    <div id="results"></div>
    
    <script>
        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${title}:</strong><br>${content}`;
            resultsDiv.appendChild(resultDiv);
        }

        async function checkRawFeed() {
            try {
                // Load user settings to get RSS URL
                const response = await fetch('letterboxd-export/users.json');
                const users = await response.json();
                const currentUser = users.find(u => u.username === 'ghosteffect');
                
                if (!currentUser || !currentUser.rssUrl) {
                    addResult('Error', 'No RSS URL found', 'error');
                    return;
                }
                
                addResult('RSS URL', currentUser.rssUrl, 'info');
                
                // Fetch raw RSS
                const rssResponse = await fetch(currentUser.rssUrl);
                const rssText = await rssResponse.text();
                
                addResult('Raw RSS Content', `<pre>${rssText.substring(0, 2000)}...</pre>`, 'info');
                
                // Parse as XML
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(rssText, 'text/xml');
                
                const items = Array.from(xmlDoc.querySelectorAll('item'));
                addResult('Items Found', `${items.length} items in RSS feed`, 'info');
                
                // Show first 5 items
                items.slice(0, 5).forEach((item, index) => {
                    const title = item.querySelector('title')?.textContent || '';
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || '';
                    
                    addResult(`Item ${index + 1}`, 
                        `Title: ${title}<br>Date: ${pubDate}<br>Link: ${link}`, 
                        'info');
                });
                
            } catch (error) {
                addResult('Error', `Failed to check RSS: ${error.message}`, 'error');
                console.error('RSS check error:', error);
            }
        }

        // Run check when page loads
        window.addEventListener('load', checkRawFeed);
    </script>
</body>
</html>
